# Day 2-1 | 要件確認 × システム設計の出発点 (1): ビジネスロジックの変換

システムが稼働を開始する前に、私たちは多かれ少なかれ達成したい主要なビジネス目的を持っています。

最もシンプルな1ページの公式ウェブサイトや広告ページであっても、その存在目的は:**人々に迅速に情報を届けること**です。

したがって、システム設計を実施する前に、あらゆる要件確認会議やコンテンツ同期に積極的に参加し、設計・開発しようとしているシステムについて、最初から大まかながらも明確な概念を持つ必要があります。

## ビジネスロジックの本質:現象から本質へ

### 要件の3つのレベル

**現象レベル**:ユーザーが言うこと

- 「物流を追跡できるソフトウェアが欲しい」
- 「リアルタイム追跡が必要で、遅延は許されない」
- 「いつでも自宅の状況を監視したい」

**本質レベル**:需要の背後にある真の動機

- 時間のコントロールへの欲求
- リスクに対する不安とコントロール
- 責任の想定と共有

**存在レベル**:システムによって変化した生活の状態

- 受動的な待機から能動的なコントロールへ
- 不確実性から予測可能性へ
- 個人の責任から集団的な協力へ

### 形而上学の具現化としてのコード

コードは、抽象的なビジネスロジックをコードを通じて具体的なルールに変換する具体的なツールです。直接的に抽象的な「正義」を記述できないのと同様に、法的規定を通じて実用的な行動規則に変換できます。

このプロセスは「哲学的抽象化と還元」です:

- **抽象化**:ユーザーの言葉から核心的な意図性を抽出
- **モデリング**:ドメイン概念でビジネスの本質を記述
- **還元**:アーキテクチャサービスを通じてシステムを実際に動作させる

これはまた、現代のエンジニアが学ぶべき最も重要で非常に価値のある能力でもあります - **卓越性の感覚**、抽象的な概念をどのようにゆっくりと壮大なタペストリーに展開していくか。

もちろん、私たちの議論は常に美しいものです。
エンジニア間では、アルゴリズムとデータ型はバベルの塔のようなもので、円滑なコミュニケーションのための基本的な環境を確立します。

しかし、プログラマーでない人々はこの言語を理解しません。AIによって生成された要件仕様書でさえ、その背後にあるトレードオフで考慮されていない技術的配慮が含まれている場合があります。

この種の曖昧な空間は、間違いなく私たちを狂わせます。曖昧な要求は、神殿の司祭が突然「神々はあなたに勇気を捧げることを必要としている」と言うのと同じです。
勇気には多くの種類があります。壮大な剣闘士の祝宴、勝利の征服、オリンピックの月桂冠、さらには心の中の考えを認めることさえあります。では、どうすればよいのでしょうか。神々が**本当に**何を必要としているのか、どのように知ることができるのでしょうか?

そこで、ドメイン駆動設計の哲学的思考コンテキストが必要になります。

## DDD:ドメイン駆動の認知フレームワーク

### なぜドメイン思考が必要なのか?

Eric Evansは「ドメイン駆動設計:ソフトウェアの核心における複雑さへの取り組み」で強調しています:エンジニアはコードの優雅さを追求するだけでなく、最も重要なのはビジネスロジックの深い理解です。

しかし、「ビジネスロジック」とは何でしょうか?現象学的な観点から見ると、すべてのビジネスにはその**意図性**があります - それは特定の目的と価値実現の方法を指しています。

**投資取引システムの意図性**:時間の究極的なコントロール
**家族の財務システムの意図性**:集団的リソースの協調管理
**健康監視システムの意図性**:身体状態の継続的な認識

### ドメインモデリングの哲学的基盤

各ドメインには独自の**存在論的構造**があります:

```py
ドメイン存在論
├── エンティティ - アイデンティティを持つ核心概念
├── 値オブジェクト - 記述的属性
├── 集約 - 一貫性の境界
└── ドメインイベント - 状態変化の意味
```

これは単なる技術パターンではなく、ビジネスの本質を理解するための認知ツールでもあります。

## イベントストーミング:ビジネス現象を可視化する

### イベントからビジネスの時間性を見る

イベントストーミングの核心的な洞察:**ビジネスは本質的に時間内のイベントのシーケンスである**。

従来の要件分析は「システムは何をすべきか」を尋ねますが、イベントストーミングの発明者であるAlberto Brandoliniは、別の重要な質問を指摘しています:「何が起こったのか、そしてなぜそれが重要なのか」。

**オブジェクト間の相互作用はイベントの発生に基づいており、イベントの発生はオブジェクトデータの差異を引き起こす。**

これは非常に重要な概念です。なぜなら、データの存在原理は情報(info)の変化によるものであり、情報(info)の変化がデータとして記録される理由は、**抽象的なビジネスロジックを実現するため**だからです。

まさにこのため、Alberto Brandoliniは各イベントの相関性を強調し、イベントとイベントのアプリケーション要件について議論しています。

### 実践フレームワーク:現象学的イベントストーミング(株式取引シナリオ)

**ステップ1:重要なイベントを特定する**
「注文作成」を記録するだけでなく、「このイベントがユーザーにとって何を意味するか」を理解する:

- コントロール志向のユーザーの場合:計画が実行され始める
- 社会志向のユーザーの場合:期待が満たされようとしている
- セキュリティ志向のユーザーの場合:コミットメントが正式に有効になる

**ステップ2:イベントの意図性を探る**
各イベントの背後にある動機は何か?

- 「価格警告がトリガーされた」 → 損失への不安
- 「予算超過アラーム」 → コントロールを失うことへの恐怖
- 「デバイスオフライン通知」 → 責任への懸念

**ステップ3:技術実装へのマッピング**
イベントの意図性に基づいて技術戦略を決定する:

- 不安駆動型イベントは低遅延を必要とする(WebSocket + Lambda@Edge)
- 恐怖駆動型イベントは信頼性を必要とする(SQS + DLQ + Retry)
- 懸念駆動型イベントは可観測性を必要とする(CloudWatch + SNS)

## 要件存在論:分析ツールとしてのMBTI

### なぜMBTIを選ぶのか?

MBTIは単なる心理テストではなく、**認知モデルの分類システム**です。異なるユーザーが世界をどのように認識し、決定を下し、生活を組織化するかを理解するのに役立ちます。
私はMBTIがシナリオセグメンテーションに有用なツールだと考えています。主に以下に基づいています:

- 外向性または内向性(E/I)
- 感覚または直観(S/N)
- 思考または感情(T/F)
- 判断または知覚(J/P)

これらの4つの象限は、私たちが決定を下す主要な方向でもあります。

他にも性格分析ツールやより専門的なマーケティングロールプレイングプロファイルが存在するに違いありませんが、今のところ、人生で遭遇する可能性のある状況をできるだけシンプルかつ包括的にシミュレートしてみましょう。

**4つの認知次元の技術的対応**:

| 認知次元 | システム設計への影響 |
| --- | --- |
| E/I(エネルギーの方向) | 協力 vs. パーソナライゼーション |
| S/N(情報処理) | 具体的 vs. 抽象的 |
| T/F(意思決定) | 効率 vs. 体験 |
| J/P(ライフスタイル) | 構造 vs. 柔軟性 |

### 6つの典型的なケースの詳細分析

---

#### ケース1:投資取引システム [I-N-T-J] - コントロール志向の需要

**現象レベル**:「スピードが十分でないと損をするのが怖い」
**本質レベル**:時間コントロールの究極的な需要
**存在レベル**:市場の受動的な受け手から能動的な時間管理者へ

**イベントストーミング分析**:
市場データ更新 → 価格分析トリガー → 取引決定生成 →
注文送信 → 取引確認 → ポジション更新 → リスク再計算

各イベントの遅延は不安を引き起こす可能性があるため、以下が必要です:

- **極めて低い遅延**:WebSocket + Lambda@Edge + ElastiCache
- **データ一貫性**:DynamoDB Transactions
- **高速障害復旧**:Multi-AZ + Auto Failover

---

#### ケース2:家族財務システム [E-N-T-J] - 協調志向の需要

**現象レベル**:「家族で一緒に記録して予算の不均衡を避ける」
**本質レベル**:集団的責任の協調とコントロール
**存在レベル**:個人的な財務管理から家族ガバナンスシステムへ

**核心イベント**:「予算境界に触れた」

- このイベントはENTJユーザーにとって「コントロールが挑戦されている」ことを意味する
- システムは直ちに「コントロールを取り戻す」パスを提供する必要がある
- 技術実装:SNSリアルタイム通知 + Lambda自動権限調整

---

#### ケース3:健康監視システム [I-S-T-J] - 確実性の需要

**現象レベル**:「身体データが正しく同期されているかタイムリーに知りたい」
**本質レベル**:身体状態の継続的な確認の必要性
**存在レベル**:健康に対する受動的な心配から能動的な監視へ

**重要な洞察**:ユーザーが最も気にするのはデータそのものではなく、「データの信頼性」です

- **データの完全性**はリアルタイム性よりも重要
- **同期状態の可視性**は機能の豊富さよりも重要
- 技術実装:IoT Core + Timestream + CloudWatch Dashboards

---

#### ケース4:スマートホーム監視システム [I-S-T-P] - 適応性の需要

**現象レベル**:「いつでもスマートデバイスを監視して高齢者や子供の安全を確保し、時折の遅延は許容できる」
**本質レベル**:責任を負うことにおける柔軟なバランス
**存在レベル**:心配する人から守護者への役割変換

**核心矛盾分析**:「いつでも監視」 vs. 「遅延を受け入れる」

- 日常の状態監視は遅延可能(**コスト最適化**)
- 緊急イベントはリアルタイムでなければならない(**責任の底線**)
- 技術実装:IoT Device Management + Kinesis + Lambda + SNS

---

#### ケース5:荷物追跡システム [I-S-T-P] - 透明性の需要

**現象レベル**:「荷物の進捗をリアルタイムで追跡し、時折のエラーは許容できる」
**本質レベル**:不確実性に対するコントロールの穏やかな必要性
**存在レベル**:受動的な待機から能動的な知ることへ

**ケース4との哲学的比較**:
両方ともISTPですが、責任の程度が異なります:

- ケース4:他者の安全に対する重い責任を負う
- ケース5:個人的な期待の軽い責任を管理する

この違いは、システム設計のフォールトトレランス戦略に直接影響します:

- ホーム監視にはバックアップメカニズムが必要
- 荷物追跡は優雅に劣化できる

**イベントストーミングにおける「待機の哲学」**:
荷物発送 → ステータス同期 → 位置更新 →
異常検出 → 期待調整 → 配達確認

核心イベントは「ステータス更新」ではなく「期待調整」です

- ISTPユーザーは、情報が透明である限り、遅延に合理的に対処できる
- 「許容可能なエラー」は、システムの正直な通知が完璧なパフォーマンスよりも重要であることを意味する

**技術実装の誠実設計**:

- API Gateway:複数データソースの統合
- DynamoDB:状態変化の追跡可能な記録
- EventBridge:非同期更新の優雅な処理
- CloudWatch:システム健全性の透明性

---

#### ケース6:旅行共有プラットフォーム [E-N-F-P] - 創造的需要

**現象レベル**:「いつでも旅行のインスピレーションを記録し、ルートマップや交通手段を共有する」
**本質レベル**:創造的表現と社会的つながりへの欲求
**存在レベル**:個人的な体験から共有価値への昇華

**ENFP認知モデルの技術的課題**:

- **E(外向性)**:リアルタイム共有と相互作用メカニズムが必要
- **N(直観)**:インスピレーションは瞬間的で、障壁のない記録が必要
- **F(感情)**:機能的完璧さよりも感情的共鳴を重視
- **P(知覚)**:コンテンツ形式が可変で、構造は適応性が必要

**創造的プロセスのイベントストーミング**:
インスピレーショントリガー → コンテンツキャプチャ → コンテキストタグ付け →
創造的処理 → 共有・公開 → コミュニティ相互作用 → インスピレーション再生

**重要な洞察**:創造的システムの設計哲学

- **キャプチャは整理よりも優れている**:まず記録し、後で整理する
- **表現は完璧さよりも優れている**:公開できることが完全な機能よりも重要
- **つながりはコンテンツよりも優れている**:社会的価値は情報価値よりも高い

**AWSの創造的サポートアーキテクチャ**:

- S3:マルチメディアコンテンツの無制限ストレージ
- AppSync:社会的相互作用のリアルタイムコラボレーション
- Cognito:アイデンティティ認証のコミュニティ基盤
- Location Service:地理的タグ付けのコンテキスト化
- オフライン同期:ネットワークによってインスピレーションが失われない

---

### 6つのケースの認知モデルマトリックス

| ケース | 認知モデル | 核心需要 | 技術焦点 | AWS戦略 |
| --- | --- | --- | --- | --- |
| 投資取引 | I-N-T-J | 時間コントロール | 低遅延 | WebSocket + Lambda@Edge |
| 家族財務 | E-N-T-J | 協調コントロール | 権限管理 | Cognito + DynamoDB |
| 健康監視 | I-S-T-J | データ確実性 | 信頼性 | IoT Core + Timestream |
| ホーム監視 | I-S-T-P | 柔軟な責任 | 階層的対応 | Kinesis + Lambda |
| 荷物追跡 | I-S-T-P | 透明性 | 複数ソース統合 | API Gateway + EventBridge |
| 旅行共有 | E-N-F-P | 創造的表現 | 社会的相互作用 | AppSync + S3 |

## ビジネスロジックの変換 - 現象 x 本質 x 存在

今日の哲学的分析を通じて、曖昧なユーザー表現を明確な機能要件に変換することに成功しました。しかし、これは最初のステップに過ぎません。

特定のAWSアーキテクチャの設計を開始すると、より深い問題があることがわかります:

- 「リアルタイム」とはミリ秒単位の遅延で何を意味するのか?
- 「いつでも監視」はどれだけの同時実行性をサポートする必要があるのか?
- 「失敗できない」とはナイン(9)の可用性で何を意味するのか?
- 「管理可能なコスト」の予算上限は何か?

これらは**非機能要件**です - それらはシステムの技術仕様とAWSサービスの特定の構成を決定します。

明日は「ドメイン境界と基本要件確認」について議論し、API設計、容量計画、災害復旧戦略などの技術仕様の哲学的基盤について詳細に議論します。

## 今日の認知フレームワーク

- **ビジネスロジックの存在論**:現象から本質、存在への3層分析
- **DDDの認知的価値**:ビジネス理解のツールとしてのドメインモデル
- **イベントストーミングの時間性**:イベントにおけるビジネスの意図性を見る
- **MBTIの技術的マッピング**:コアユーザーの認知モデルがアーキテクチャの選択を決定する

覚えておいてください:アーキテクトの核心的能力は、AWSサービスのリストを暗記することではなく、「なぜユーザーがこのシステムを必要としているのか」を理解することです。テクノロジーは目標を達成するための手段に過ぎず、目標の背後にある人間のニーズが設計の哲学的基盤です。

---

> 「すべてのシステムにはその意図性があり、それはユーザーの存在状態の特定の変換を指しています。私たちは機能を設計しているのではなく、可能性を設計しているのです。」
